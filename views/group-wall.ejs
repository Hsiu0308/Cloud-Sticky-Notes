<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include ("partials/header") %>
    <title><%= group.title %> - ç‰†é¢</title>
    <style>
      body {
        min-height: 100vh;
        transition: background 0.3s;
      }

      section.group-info {
        background-color: white;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border-radius: 0.8rem;
      }
      .group-header-container {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }
      .group-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      @media (max-width: 768px) {
        .group-header-container {
          flex-direction: column;
          text-align: center;
        }
        .action-buttons {
          width: 100%;
          justify-content: center;
          margin-top: 1rem;
        }
      }

      .sticky-note {
        width: 100%;
        min-height: 250px;
        padding: 1.5rem 1.2rem;
        position: relative;
        font-family: "Comic Sans MS", "Chalkboard SE", sans-serif;
        transition: transform 0.2s ease;
      }
      .note-title {
        font-weight: bold;
        font-size: 1.4rem;
        margin-bottom: 1rem;
        border-bottom: 2px dashed rgba(0, 0, 0, 0.1);
        padding-bottom: 0.5rem;
        color: #333;
      }
      .note-author {
        font-size: 0.85rem;
        color: #666;
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
      }
      .note-content {
        white-space: pre-wrap;
        height: 100px;
        overflow-y: auto;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        color: #555;
      }
      .note-actions {
        position: absolute;
        bottom: 15px;
        right: 15px;
        left: 15px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
      }
      .note-date {
        font-size: 0.8rem;
        color: #888;
      }
      .action-btn {
        font-size: 0.9rem;
        text-decoration: none;
        padding: 2px 8px;
        border-radius: 4px;
        transition: 0.2s;
      }
      .edit-btn {
        color: #555;
      }
      .edit-btn:hover {
        background-color: rgba(0, 0, 0, 0.05);
        color: #000;
      }
      .delete-btn {
        color: #d9534f;
      }
      .delete-btn:hover {
        background-color: rgba(217, 83, 79, 0.1);
      }

      .sticky-note.yellow {
        background-color: #fdfd86;
      }
      .sticky-note.blue {
        background-color: #a6dcef;
      }
      .sticky-note.green {
        background-color: #caf0b6;
      }
      .sticky-note.pink {
        background-color: #ffccdb;
      }

      /* =========================================
         ğŸ  ä¸»é¡Œ Aï¼šæº«é¦¨å®¶åº­ (å†°ç®±ç£éµé¢¨æ ¼) - theme-family
         ========================================= */
      body.theme-family {
        background-color: #f0f2f5;
        background-image: radial-gradient(#dfe3e8 1px, transparent 0);
        background-size: 20px 20px;
      }

      .theme-family .sticky-note::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 20px;
        background: radial-gradient(
          circle at 30% 30%,
          #ff6b6b,
          #c92a2a
        ); /* ç´…è‰²ç£éµ */
        border-radius: 50%;
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        z-index: 20;
      }

      /* å¶æ•¸å¼µæ›é»‘è‰²ç£éµ */
      .theme-family div[class*="col-"]:nth-child(even) .sticky-note::before {
        background: radial-gradient(circle at 30% 30%, #495057, #212529);
      }

      .theme-family .sticky-note {
        transform: rotate(-2deg);
        box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.15);
      }
      .theme-family div[class*="col-"]:nth-child(even) .sticky-note {
        transform: rotate(2deg);
        top: 6px;
      }
      .theme-family .sticky-note:hover {
        transform: scale(1.05) rotate(0deg) !important;
        z-index: 100;
        box-shadow: 10px 15px 20px rgba(0, 0, 0, 0.2);
      }

      /* =========================================
         ğŸ’¼ ä¸»é¡Œ Bï¼šå°ˆæ¥­å·¥ä½œ (ç™½æ¿åœ–é‡˜é¢¨æ ¼) - theme-work
         ========================================= */
      body.theme-work {
        background-color: #e6ccb2; /* è»Ÿæœ¨å¡åº•è‰² */
        background-image: url("https://www.transparenttextures.com/patterns/cork-board.png");
      }

      body.theme-work nav {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1000;
      }

      body.theme-work section.group-info {
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        border: 1px solid #d4a373;
      }

      .theme-work .sticky-note::before {
        content: "";
        position: absolute;
        top: -14px;
        left: 50%;
        transform: translateX(-50%);
        width: 18px;
        height: 18px;
        border-radius: 50%;

        /* ç«‹é«”ç´…è‰²å¤§é ­é‡ */
        background: radial-gradient(circle at 25% 25%, #ff7f7f, #cc0000);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.4),
          inset 0 2px 5px rgba(255, 255, 255, 0.3);
        z-index: 20;
      }

      /* å¶æ•¸ä¾¿åˆ©è²¼æ›è—è‰²åœ–é‡˜ */
      .theme-work div[class*="col-"]:nth-child(even) .sticky-note::before {
        /* ç«‹é«”è—è‰²å¤§é ­é‡ */
        background: radial-gradient(
          circle at 25% 25%,
          #87ceeb,
          #0000cd
        ); /* è—è‰²æ¼¸å±¤ */
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.4),
          inset 0 2px 5px rgba(255, 255, 255, 0.3);
      }

      .theme-work .sticky-note {
        transform: rotate(0deg);
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
        border-radius: 2px;
      }

      .theme-work .sticky-note:hover {
        transform: scale(1.02);
        box-shadow: 5px 8px 12px rgba(0, 0, 0, 0.25);
        z-index: 100;
      }

      @media (max-width: 768px) {
        .theme-work .sticky-note {
          transform: rotate(0deg) !important;
        }
      }
    </style>
  </head>

  <body class="theme-<%= group.theme || 'family' %>">
    <%- include ("partials/nav") %>

    <div class="container mt-4">
      <section class="group-info">
        <div class="group-header-container">
          <img
            class="group-avatar"
            src="<%= group.theme === 'work' ? 'https://cdn.pixabay.com/photo/2017/06/10/07/18/list-2389219_1280.png' : 'https://cdn.pixabay.com/photo/2016/11/14/17/39/group-1824145_1280.png' %>"
            alt="Group Icon"
          />

          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-1">
              <h2 class="mb-0 fw-bold"><%= group.title %></h2>
              <span
                class="badge rounded-pill <%= group.theme === 'work' ? 'bg-primary' : 'bg-success' %>"
              >
                <%= group.theme === 'work' ? 'ğŸ’¼ å·¥ä½œå€' : 'ğŸ  å®¶åº­' %>
              </span>
            </div>
            <small class="text-muted">
              é€šè¡Œç¢¼ï¼š<span class="badge bg-light text-dark border"
                ><%= group.passcode %></span
              >
              &nbsp;|&nbsp; æˆå“¡ï¼š<%= group.members.length %> äºº
            </small>
          </div>

          <div class="d-flex gap-2 action-buttons">
            <a
              href="/groups/<%= group._id %>/post"
              class="btn btn-warning fw-bold shadow-sm"
              >âœï¸ è²¼æ–°ä¾¿åˆ©è²¼</a
            >
            <a href="/groups" class="btn btn-outline-secondary">å›å¤§å»³</a>
          </div>
        </div>
      </section>

      <div class="row">
        <% posts.forEach(post => { %>
        <div class="col-12 col-sm-6 col-lg-3 mb-4">
          <div class="sticky-note <%= post.color || 'yellow' %>">
            <span class="note-author">ğŸ‘¤ <%= post.authorName || 'æˆå“¡' %></span>
            <div class="note-title"><%= post.title %></div>

            <div class="note-content"><%= post.content %></div>

            <div class="note-actions">
              <span class="note-date">
                <% if (group.theme === 'family') { %> <% const hours = new
                Date(post.date).getUTCHours() + 8; const localHours = hours >=
                24 ? hours - 24 : hours; let timeGreeting = ""; if(localHours <
                5) timeGreeting = "ğŸŒ™ æ·±å¤œ"; else if(localHours < 11)
                timeGreeting = "â˜€ï¸ æ—©å®‰"; else if(localHours < 14) timeGreeting
                = "ğŸ± åˆå®‰"; else if(localHours < 18) timeGreeting = "â˜•ï¸ åˆå¾Œ";
                else timeGreeting = "ğŸ  æ™šå®‰"; %>
                <small
                  class="fw-bold text-secondary"
                  style="font-size: 0.8em; display: block"
                >
                  <%= timeGreeting %>
                </small>
                <% } %> <%= post.date.toLocaleDateString("zh-TW", { timeZone:
                "Asia/Taipei" }) %>
              </span>

              <% if (post.author === user._id.toString()) { %>
              <div>
                <a
                  href="/groups/<%= group._id %>/post/edit/<%= post._id %>"
                  class="action-btn edit-btn"
                  >âœï¸ ç·¨è¼¯</a
                >
                <a
                  href="/groups/<%= group._id %>/post/delete/<%= post._id %>"
                  class="action-btn delete-btn"
                  onclick="return confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')"
                  >ğŸ—‘ï¸</a
                >
              </div>
              <% } %>
            </div>
          </div>
        </div>
        <% }) %> <% if (posts.length === 0) { %>
        <div class="text-center text-muted mt-5">
          <h3>ç‰†ä¸Šé‚„æ²’æœ‰æ±è¥¿ï¼Œæ¶é ­é¦™ï¼</h3>
        </div>
        <% } %>
      </div>
    </div>
  </body>
</html>
