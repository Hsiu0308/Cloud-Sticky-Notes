<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include ("partials/header") %>
    <title>我的群組</title>
  </head>
  <body class="bg-light">
    <%- include ("partials/nav") %>
    <div class="container mt-5">
      <%- include ("partials/message") %>

      <div class="row">
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h4 class="fw-bold">🚀 建立新群組</h4>
              <p class="text-muted">當個創世神，建立屬於你們的空間。</p>
              <form action="/groups/create" method="POST">
                <div class="mb-2">
                  <input
                    name="title"
                    type="text"
                    class="form-control"
                    placeholder="群組名稱 (例: Team)"
                    required
                  />
                </div>
                <div class="mb-3">
                  <input
                    name="passcode"
                    type="text"
                    class="form-control"
                    placeholder="設定通行碼 (例: team001)"
                    required
                  />
                </div>
                <button class="btn btn-primary w-100">建立群組</button>
              </form>
            </div>
          </div>

          <div class="card shadow-sm">
            <div class="card-body">
              <h4 class="fw-bold">🤝 加入群組</h4>
              <p class="text-muted">輸入朋友給你的通行碼。</p>
              <form action="/groups/join" method="POST">
                <div class="mb-3">
                  <input
                    name="passcode"
                    type="text"
                    class="form-control"
                    placeholder="輸入通行碼"
                    required
                  />
                </div>
                <button class="btn btn-outline-success w-100">加入</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <h2 class="fw-bold mb-4">📂 我加入的群組</h2>
          <div class="row">
            <% if (groups.length === 0) { %>
            <div class="col-12 text-center text-muted mt-4">
              <h4>目前還沒有參加任何群組喔！</h4>
            </div>
            <% } %> <% groups.forEach(group => { %>
            <div class="col-md-6 mb-3">
              <div
                class="card shadow-sm h-100 border-0"
                style="background: white"
              >
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-start">
                    <h3 class="fw-bold text-dark"><%= group.title %></h3>
                    <span class="badge bg-secondary"
                      >Code: <%= group.passcode %></span
                    >
                  </div>
                  <p class="text-muted mt-2">
                    成員數: <%= group.members.length %> 人
                  </p>
                  <div class="mt-auto d-flex gap-2">
                    <a
                      href="/groups/<%= group._id %>"
                      class="btn btn-warning fw-bold flex-grow-1"
                      >進入牆面 🏃‍♂️</a
                    >

                    <a
                      href="/groups/<%= group._id %>/leave"
                      class="btn btn-outline-danger"
                      onclick="return confirmLeave(<%= group.members.length %>)"
                    >
                      退出
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
      </div>
    </div>

    <script>
      function confirmLeave(memberCount) {
        if (memberCount === 1) {
          return confirm(
            "⚠️ 嚴重警告！\n\n你是群組內最後一位成員。\n如果你現在退出，此群組與所有便利貼將被「永久刪除」且無法復原！\n\n確定要解散群組嗎？"
          );
        } else {
          return confirm("確定要退出這個群組嗎？");
        }
      }
    </script>
  </body>
</html>
